#!/usr/bin/env ruby

require "rubygems"
require "win32/daemon"
require "polldeploy"

include Win32

class PollDeployDaemon < Daemon
  def service_main
    PollDeploy::ServiceLog.log_info("polldeploy service started")
    while running?
      PollDeploy::ServiceLog.log_info("Checking for new artifacts...")
      sleep PollDeploy::Config::DEFAULT_POLLING_INTERVAL
    end
  end
  
  def service_stop
    PollDeploy::ServiceLog.log_info("polldeploy service stopped")
    exit!
  end
end

PollDeployDaemon.mainloop